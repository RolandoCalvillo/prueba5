<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Evaluación Modular - CNCI</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #2a6aff, #ff8500);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            color: #4b5563;
        }
        .container {
            max-width: 1200px;
            width: 100%;
            margin: 0 auto;
            padding: 2rem;
        }
        .card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 1.5rem;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
        }
        .tab-button {
            transition: all 0.3s ease;
        }
        .tab-button.active {
            background-color: #2a6aff;
            color: white;
            border-color: #2a6aff;
        }
        .criteria-button {
            transition: transform 0.3s ease;
        }
        .criteria-button.rotate {
            transform: rotate(180deg);
        }
    </style>
</head>
<body>

    <div id="app" class="container">
        <!-- Contenido dinámico de la aplicación -->
    </div>

    <script>
        // Objeto para simular la base de datos de usuarios
        const usersDB = {
            'admin': { role: 'admin' },
            'Usuario01': {
                role: 'user',
                data: {
                    name: 'José Pérez',
                    viciCode: 'vici-j01',
                    generalScore: 85,
                    callGoal: 75,
                    generalComments: 'Pedro, has demostrado un excelente desempeño este mes. Tu atención a los alumnos es destacable y sigues los procesos de manera consistente. Debes mejorar en los tiempos de respuesta para alcanzar los objetivos del equipo.',
                    categories: [{
                        id: 'retencion',
                        name: 'Retención',
                        emoji: '🤝',
                        score: 9.0,
                        comments: {
                            supervision: 'Se cumplió la meta de retención.',
                            quality: 'Excelentes habilidades de seguimiento.',
                        },
                        criteria: [
                            { name: 'Seguimiento a población morosa.', score: 10 },
                            { name: 'Total de bajas de alumnos con morosidad.', score: 8 },
                            { name: 'Uso adecuado y oportuno de la columna de retención de CRM...', score: 9 },
                            { name: 'Retención y bajas pagadas.', score: 9 },
                        ],
                        color: 'bg-indigo-200'
                    }, {
                        id: 'reincorporacion',
                        name: 'Reincorporación',
                        emoji: '🔄',
                        score: 7.0,
                        comments: {
                            supervision: 'Se logró una buena tasa de reingreso.',
                            quality: 'Área de oportunidad en la difusión de promociones.',
                        },
                        criteria: [
                            { name: 'Bajas por no pago.', score: 7 },
                            { name: 'Búsqueda y difusión de promociones.', score: 6 },
                            { name: 'Registro y seguimiento.', score: 8 },
                            { name: 'Cierre de prospectos.', score: 7 },
                        ],
                        color: 'bg-green-200'
                    }, {
                        id: 'procesos',
                        name: 'Procesos',
                        emoji: '⚙️',
                        score: 9.5,
                        comments: {
                            supervision: 'Manejo impecable de los procesos académicos.',
                            quality: 'Excelente organización y eficiencia.',
                        },
                        criteria: [
                            { name: 'Procesos académicos: Cambio de carrera y/o programa...', score: 10 },
                            { name: 'Documentación completa y correcta.', score: 9 },
                            { name: 'Trámites en tiempo y forma.', score: 9.5 },
                        ],
                        color: 'bg-purple-200'
                    }, {
                        id: 'comunicacion',
                        name: 'Comunicación',
                        emoji: '💬',
                        score: 8.5,
                        comments: {
                            supervision: 'Comunicación fluida con los alumnos y el equipo.',
                            quality: 'Mensajes claros y sin errores.',
                        },
                        criteria: [
                            { name: 'Redacción impecable y sin errores ortográficos.', score: 9 },
                            { name: 'Uso de canales formales.', score: 8 },
                            { name: 'Sinergia con otros departamentos.', score: 8.5 },
                        ],
                        color: 'bg-yellow-200'
                    }, {
                        id: 'administrativas',
                        name: 'Actividades Administrativas',
                        emoji: '📋',
                        score: 8.0,
                        comments: {
                            supervision: 'Registro de actividades consistente.',
                            quality: 'Mejorar la proactividad en guardias.',
                        },
                        criteria: [
                            { name: 'Registra en tiempo (diario) sus actividades en el reporte...', score: 9 },
                            { name: 'Asigna y actualiza perfiles.', score: 8 },
                            { name: 'Canaliza de manera óptima las situaciones...', score: 7 },
                        ],
                        color: 'bg-pink-200'
                    }, {
                        id: 'general',
                        name: 'General',
                        emoji: '📊',
                        score: 9.2,
                        comments: {
                            supervision: 'Desempeño general sobresaliente.',
                            quality: 'Excelente actitud y compromiso.',
                        },
                        criteria: [
                            { name: 'Productividad.', score: 9 },
                            { name: 'Calidad de trabajo.', score: 9.5 },
                            { name: 'Asertividad en la comunicación.', score: 9 },
                        ],
                        color: 'bg-gray-200'
                    }, {
                        id: 'whatsapp',
                        name: 'WhatsApp',
                        emoji: '📱',
                        score: 10.0,
                        comments: {
                            supervision: 'Manejo ejemplar de los chats.',
                            quality: 'Respuestas rápidas y asertivas.',
                        },
                        criteria: [
                            { name: 'Tiempos de respuesta óptimos.', score: 10 },
                            { name: 'Manejo de objeciones.', score: 10 },
                            { name: 'Redacción impecable.', score: 10 },
                        ],
                        color: 'bg-lime-200'
                    }],
                    trends: {
                        scores: {
                            'retencion': [85, 87, 88, 89, 90, 91, 88, 89, 92, 90, 89, 91],
                            'reincorporacion': [70, 75, 78, 80, 81, 85, 83, 82, 85, 86, 84, 87],
                            'procesos': [90, 92, 93, 94, 95, 96, 94, 95, 96, 97, 95, 98],
                            'general': [80, 82, 85, 86, 88, 89, 87, 89, 90, 88, 89, 90],
                        },
                        monthly: {
                            'month-2': { score: 90, trend: 'up' },
                            'month-1': { score: 91, trend: 'up' },
                            'current': { score: 92, trend: 'up' }
                        },
                        improvement: 'Incremento del 5% en la tasa de reincorporación, superando la meta del equipo.',
                        criticalArea: 'Mantener la agilidad en respuestas de WhatsApp durante picos de alta demanda.',
                    },
                    badges: [{
                        title: '🏆 Maestro(a) de Procesos',
                        description: 'Por su excelente manejo y seguimiento de los procesos académicos.'
                    }, {
                        title: '🚀 Asertividad Total',
                        description: 'Por su asertividad y claridad en la comunicación con los alumnos.'
                    }],
                    upcomingBadges: {
                        strengths: ['Excelencia en el seguimiento de procesos.', 'Capacidad de resolución de problemas.'],
                        opportunities: ['Incrementar la proactividad en guardias.', 'Mejorar los tiempos de respuesta en horarios pico.']
                    },
                    improvementPlan: {
                        instructions: 'Instrucciones para el Plan de Mejora. A partir de los resultados de tu evaluación, identifica de 3 a 4 áreas de oportunidad y describe acciones concretas que puedas implementar para mejorarlas. Indica el plazo estimado y cómo darás seguimiento a cada acción. Sé específico y realista para facilitar el cumplimiento y la evaluación de avances. Ingresa al siguiente enlace, redacta y establece tu plan de mejora antes del 11 de septiembre de 2025.',
                        link: 'https://www.google.com'
                    }
                }
            },
            // Genera datos simulados para los usuarios 02-18
            ...Array.from({ length: 17 }, (_, i) => {
                const userNum = (i + 2).toString().padStart(2, '0');
                const score = Math.floor(Math.random() * 20) + 70; // Puntaje entre 70 y 90
                const categories = ['Retención', 'Reincorporación', 'Procesos', 'Comunicación', 'Actividades Administrativas', 'General', 'WhatsApp'];
                return {
                    [`Usuario${userNum}`]: {
                        role: 'user',
                        data: {
                            name: `Usuario ${userNum}`,
                            viciCode: `vici-${userNum}`,
                            generalScore: score,
                            callGoal: Math.floor(Math.random() * 30) + 60,
                            generalComments: `Comentarios generales para el Usuario ${userNum}.`,
                            categories: categories.map(cat => ({
                                id: cat.toLowerCase().replace(/\s+/g, ''),
                                name: cat,
                                emoji: '📊',
                                score: (Math.random() * 5) + 5, // Score entre 5 y 10
                                comments: { supervision: `Comentario de Supervisión para ${cat}.`, quality: `Comentario de Calidad para ${cat}.` },
                                criteria: [{ name: 'Criterio genérico 1', score: 8 }, { name: 'Criterio genérico 2', score: 9 }],
                                color: 'bg-blue-200'
                            })),
                            trends: {
                                scores: {
                                    'retencion': Array.from({ length: 12 }, () => Math.floor(Math.random() * 20) + 70),
                                    'reincorporacion': Array.from({ length: 12 }, () => Math.floor(Math.random() * 20) + 70),
                                    'procesos': Array.from({ length: 12 }, () => Math.floor(Math.random() * 20) + 70),
                                    'general': Array.from({ length: 12 }, () => Math.floor(Math.random() * 20) + 70),
                                },
                                monthly: {
                                    'month-2': { score: Math.floor(Math.random() * 20) + 70, trend: 'up' },
                                    'month-1': { score: Math.floor(Math.random() * 20) + 70, trend: 'down' },
                                    'current': { score: Math.floor(Math.random() * 20) + 70, trend: 'up' }
                                },
                                improvement: 'Mejora genérica.',
                                criticalArea: 'Área crítica genérica.',
                            },
                            badges: [{ title: '🏅 Insignia Genérica', description: 'Descripción genérica.' }],
                            upcomingBadges: { strengths: ['Fortaleza genérica.'], opportunities: ['Oportunidad genérica.'] },
                            improvementPlan: {
                                instructions: `Instrucciones para el Plan de Mejora para el Usuario ${userNum}.`,
                                link: 'https://www.google.com'
                            }
                        }
                    }
                };
            }).reduce((acc, obj) => ({ ...acc, ...obj }), {})
        };

        let currentUser = null;
        let chartInstance = null;
        const appContainer = document.getElementById('app');

        // Función para renderizar la pantalla de login
        function renderLogin() {
            appContainer.innerHTML = `
                <div class="flex flex-col items-center justify-center p-8 bg-white/90 rounded-3xl shadow-lg w-full max-w-lg mx-auto">
                    <img src="https://i.ibb.co/m5QcyKWg/Logo-CNCI.png" alt="Logo CNCI" class="w-48 mb-6">
                    <h1 class="text-3xl font-bold text-gray-800 text-center mb-2">Evaluación Modular – Departamento de Servicios Estudiantiles</h1>
                    <h2 class="text-xl font-semibold text-gray-600 mb-4">Módulo M8, Agosto 2025 🗓️</h2>
                    <p class="text-center text-gray-500 mb-6">Consulta tu desempeño del módulo de manera detallada ingresando tu usuario Vici.</p>
                    <div class="w-full flex flex-col items-center">
                        <input id="userInput" type="text" placeholder="Ingresa tu usuario" class="w-full px-4 py-3 mb-4 text-center text-lg border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-300">
                        <button id="loginButton" class="w-full bg-[#2a6aff] hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-xl shadow-lg transform transition-all duration-300 hover:scale-105 active:scale-95">
                            Consultar mi Evaluación 🚀
                        </button>
                    </div>
                    <div id="message" class="mt-4 text-center text-sm font-semibold text-red-500"></div>
                </div>
            `;

            const userInput = document.getElementById('userInput');
            const loginButton = document.getElementById('loginButton');
            const messageDiv = document.getElementById('message');

            const handleLogin = () => {
                const user = userInput.value.trim();
                if (usersDB[user]) {
                    currentUser = usersDB[user];
                    if (currentUser.role === 'admin') {
                        renderAdminPanel();
                    } else {
                        renderDashboard();
                    }
                } else {
                    messageDiv.textContent = '❌ Usuario no encontrado. Por favor, revisa tu nombre de usuario.';
                    userInput.value = '';
                }
            };

            loginButton.addEventListener('click', handleLogin);
            userInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    handleLogin();
                }
            });
        }

        // Función para renderizar el panel de administrador
        function renderAdminPanel() {
            appContainer.innerHTML = `
                <div class="bg-white/90 p-8 rounded-3xl shadow-lg w-full">
                    <div class="flex items-center justify-between mb-8">
                        <h1 class="text-3xl font-bold text-gray-800">Panel de Administrador ⚙️</h1>
                        <button id="backButton" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-xl shadow-md transition-all duration-300">
                            ← Volver
                        </button>
                    </div>
                    <div id="adminContent" class="space-y-4">
                        <p class="text-center text-xl text-gray-600">Funcionalidad en desarrollo. Aquí se podría gestionar a los usuarios y sus datos.</p>
                    </div>
                </div>
            `;
            document.getElementById('backButton').addEventListener('click', renderLogin);
        }

        // Función para renderizar el dashboard principal
        function renderDashboard() {
            if (!currentUser || currentUser.role !== 'user') return;

            const userData = currentUser.data;

            appContainer.innerHTML = `
                <div class="bg-white/90 p-8 rounded-3xl shadow-lg w-full max-w-4xl mx-auto">
                    <div class="flex items-center justify-between mb-6">
                        <h1 class="text-2xl sm:text-3xl font-bold text-gray-800">Resultados de Evaluación 📊</h1>
                        <button id="backButton" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-xl shadow-md transition-all duration-300">
                            ← Volver
                        </button>
                    </div>
                    <p class="text-lg text-gray-600 mb-6">Hola, ${userData.name}</p>

                    <!-- Pestañas de navegación -->
                    <div class="flex flex-wrap sm:flex-nowrap justify-center sm:justify-start mb-6 border-b border-gray-200">
                        <button class="tab-button active px-4 py-2 text-sm sm:text-base font-semibold border-b-2 border-transparent hover:border-blue-500 rounded-t-lg focus:outline-none" data-tab="general">Resumen General 📈</button>
                        <button class="tab-button px-4 py-2 text-sm sm:text-base font-semibold border-b-2 border-transparent hover:border-blue-500 rounded-t-lg focus:outline-none" data-tab="trends">Tendencias 📊</button>
                        <button class="tab-button px-4 py-2 text-sm sm:text-base font-semibold border-b-2 border-transparent hover:border-blue-500 rounded-t-lg focus:outline-none" data-tab="badges">Insignias 🎖️</button>
                        <button class="tab-button px-4 py-2 text-sm sm:text-base font-semibold border-b-2 border-transparent hover:border-blue-500 rounded-t-lg focus:outline-none" data-tab="plan">Plan de Mejora 📝</button>
                    </div>

                    <!-- Contenedores de contenido de las pestañas -->
                    <div id="tabContent">
                        <!-- Contenido dinámico de las pestañas -->
                    </div>
                </div>
            `;

            document.getElementById('backButton').addEventListener('click', renderLogin);

            const tabButtons = document.querySelectorAll('.tab-button');
            const tabContent = document.getElementById('tabContent');

            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    tabButtons.forEach(btn => btn.classList.remove('active', 'bg-[#2a6aff]', 'text-white'));
                    button.classList.add('active', 'bg-[#2a6aff]', 'text-white');
                    const tab = button.getAttribute('data-tab');
                    renderTabContent(tab);
                });
            });

            // Renderiza la pestaña inicial
            renderTabContent('general');

            // Lógica para renderizar el contenido de cada pestaña
            function renderTabContent(tabName) {
                let contentHTML = '';
                if (chartInstance) {
                    chartInstance.destroy(); // Destruye el gráfico anterior si existe
                }

                switch (tabName) {
                    case 'general':
                        contentHTML = `
                            <!-- Resumen General -->
                            <div class="space-y-6">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div class="p-6 bg-blue-100 rounded-2xl shadow-md">
                                        <h3 class="font-bold text-lg mb-2 flex items-center">Calificación General 🌟</h3>
                                        <div class="w-full bg-gray-200 rounded-full h-4 relative overflow-hidden">
                                            <div class="bg-[#2a6aff] h-4 rounded-full transition-all duration-700 ease-in-out" style="width: ${userData.generalScore}%;"></div>
                                            <span class="absolute top-0 left-1/2 -translate-x-1/2 font-bold text-xs text-white">${userData.generalScore}%</span>
                                        </div>
                                    </div>
                                    <div class="p-6 bg-orange-100 rounded-2xl shadow-md">
                                        <h3 class="font-bold text-lg mb-2 flex items-center">Meta de Llamadas 📞</h3>
                                        <div class="w-full bg-gray-200 rounded-full h-4 relative overflow-hidden">
                                            <div class="bg-[#ff8500] h-4 rounded-full transition-all duration-700 ease-in-out" style="width: ${userData.callGoal}%;"></div>
                                            <span class="absolute top-0 left-1/2 -translate-x-1/2 font-bold text-xs text-white">${userData.callGoal}%</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Tarjetas de Categorías -->
                                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mt-6">
                                    ${userData.categories.map(cat => `
                                        <div class="card p-6 ${cat.color} flex flex-col">
                                            <div class="flex items-center justify-between mb-4">
                                                <h3 class="font-bold text-lg text-gray-800 flex items-center">${cat.name} ${cat.emoji}</h3>
                                                <div class="w-12 h-12 flex items-center justify-center font-bold text-lg rounded-full border-4 ${cat.score >= 7.0 ? 'border-green-500 text-green-700' : 'border-red-500 text-red-700'} bg-white">
                                                    ${cat.score.toFixed(1)}
                                                </div>
                                            </div>
                                            <!-- Pestañas de Comentarios -->
                                            <div class="flex justify-center mb-4">
                                                <button class="tab-button-internal supervision-tab active px-4 py-2 text-xs font-semibold rounded-full border border-gray-400 bg-white" data-category="${cat.id}" data-type="supervision">Supervisión</button>
                                                <button class="tab-button-internal quality-tab px-4 py-2 text-xs font-semibold rounded-full border border-gray-400 ml-2" data-category="${cat.id}" data-type="quality">Calidad</button>
                                            </div>
                                            <div class="flex-grow">
                                                <p id="comment-${cat.id}" class="text-sm text-gray-700 text-center italic">${cat.comments.supervision}</p>
                                            </div>

                                            <!-- Sección de Criterios (Expandible) -->
                                            <div class="mt-4">
                                                <button class="criteria-toggle flex items-center justify-between w-full px-4 py-2 bg-gray-300/50 hover:bg-gray-300 rounded-xl transition-colors duration-300" data-target="#criteria-list-${cat.id}">
                                                    <span class="font-semibold text-sm">Criterios de Calificación</span>
                                                    <svg class="criteria-button w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                                    </svg>
                                                </button>
                                                <ul id="criteria-list-${cat.id}" class="mt-2 space-y-1 text-sm text-gray-600 hidden">
                                                    ${cat.criteria.map(crit => `
                                                        <li class="flex justify-between items-center">
                                                            <span>• ${crit.name}</span>
                                                            <span class="font-bold">${crit.score.toFixed(1)}</span>
                                                        </li>
                                                    `).join('')}
                                                </ul>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                                <div class="mt-8 p-6 bg-white/90 rounded-2xl shadow-md">
                                    <h3 class="text-xl font-bold text-gray-800 mb-4">Comentarios generales del Supervisor 📝</h3>
                                    <p class="text-gray-700">${userData.generalComments}</p>
                                </div>
                                <div class="flex justify-center mt-6">
                                    <a href="https://www.google.com" target="_blank" class="bg-[#ff8500] hover:bg-orange-600 text-white font-bold py-3 px-6 rounded-xl shadow-lg transition-all duration-300 hover:scale-105 active:scale-95">
                                        Detalles de Evaluación 🔍
                                    </a>
                                </div>
                            </div>
                        `;
                        break;

                    case 'trends':
                        const monthlyTrendEmoji = (trend) => trend === 'up' ? '📈' : '📉';
                        contentHTML = `
                            <!-- Tendencias -->
                            <div class="space-y-6">
                                <div class="p-6 bg-gray-100 rounded-2xl shadow-md">
                                    <div class="flex items-center justify-between mb-4">
                                        <h3 class="text-xl font-bold text-gray-800">Gráfica Anual de Desempeño 🗓️</h3>
                                        <div class="flex space-x-2">
                                            <button id="selectAllButton" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold text-sm py-1 px-3 rounded-full transition-colors duration-300">Seleccionar Todo</button>
                                            <button id="deselectAllButton" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold text-sm py-1 px-3 rounded-full transition-colors duration-300">Desactivar Todo</button>
                                        </div>
                                    </div>
                                    <div class="relative h-96 w-full">
                                        <canvas id="performanceChart"></canvas>
                                    </div>
                                    <div id="chartCheckboxes" class="flex flex-wrap justify-center mt-4 gap-2"></div>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                    <div class="p-6 bg-white rounded-2xl shadow-md text-center">
                                        <h4 class="font-semibold text-gray-600">Hace 2 Meses</h4>
                                        <p class="text-3xl font-bold mt-2">${userData.trends.monthly['month-2'].score} ${monthlyTrendEmoji(userData.trends.monthly['month-2'].trend)}</p>
                                    </div>
                                    <div class="p-6 bg-white rounded-2xl shadow-md text-center">
                                        <h4 class="font-semibold text-gray-600">Mes Anterior</h4>
                                        <p class="text-3xl font-bold mt-2">${userData.trends.monthly['month-1'].score} ${monthlyTrendEmoji(userData.trends.monthly['month-1'].trend)}</p>
                                    </div>
                                    <div class="p-6 bg-white rounded-2xl shadow-md text-center">
                                        <h4 class="font-semibold text-gray-600">Mes Actual</h4>
                                        <p class="text-3xl font-bold mt-2">${userData.trends.monthly['current'].score} ${monthlyTrendEmoji(userData.trends.monthly['current'].trend)}</p>
                                    </div>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div class="p-6 bg-green-100 rounded-2xl shadow-md">
                                        <h4 class="font-bold text-lg mb-2 flex items-center">La Mayor Mejora ✅</h4>
                                        <p class="text-sm text-gray-700">${userData.trends.improvement}</p>
                                    </div>
                                    <div class="p-6 bg-red-100 rounded-2xl shadow-md">
                                        <h4 class="font-bold text-lg mb-2 flex items-center">Área Crítica ⚠️</h4>
                                        <p class="text-sm text-gray-700">${userData.trends.criticalArea}</p>
                                    </div>
                                </div>
                            </div>
                        `;
                        break;

                    case 'badges':
                        contentHTML = `
                            <!-- Insignias -->
                            <div class="space-y-6">
                                <div class="p-6 bg-white rounded-2xl shadow-md">
                                    <h3 class="text-xl font-bold text-gray-800 mb-4">Insignias Obtenidas 🌟</h3>
                                    <ul class="space-y-4">
                                        ${userData.badges.map(badge => `
                                            <li>
                                                <h4 class="font-bold text-lg text-gray-800">${badge.title}</h4>
                                                <p class="text-gray-600 text-sm mt-1">${badge.description}</p>
                                            </li>
                                        `).join('')}
                                    </ul>
                                </div>
                                <div class="p-6 bg-white rounded-2xl shadow-md">
                                    <h3 class="text-xl font-bold text-gray-800 mb-4">Próximas Insignias 🚀</h3>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <h4 class="font-semibold text-gray-700 mb-2">Fortalezas</h4>
                                            <ul class="list-disc list-inside space-y-1 text-gray-600">
                                                ${userData.upcomingBadges.strengths.map(strength => `<li>${strength}</li>`).join('')}
                                            </ul>
                                        </div>
                                        <div>
                                            <h4 class="font-semibold text-gray-700 mb-2">Áreas de Oportunidad</h4>
                                            <ul class="list-disc list-inside space-y-1 text-gray-600">
                                                ${userData.upcomingBadges.opportunities.map(opportunity => `<li>${opportunity}</li>`).join('')}
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;
                        break;

                    case 'plan':
                        contentHTML = `
                            <!-- Plan de Mejora -->
                            <div class="space-y-6">
                                <div class="p-6 bg-white rounded-2xl shadow-md">
                                    <h3 class="text-xl font-bold text-gray-800 mb-4">Plan de Mejora 🎯</h3>
                                    <p class="text-gray-700 leading-relaxed">${userData.improvementPlan.instructions}</p>
                                </div>
                                <div class="flex justify-center mt-6">
                                    <a href="${userData.improvementPlan.link}" target="_blank" class="bg-[#ff8500] hover:bg-orange-600 text-white font-bold py-3 px-6 rounded-xl shadow-lg transition-all duration-300 hover:scale-105 active:scale-95">
                                        Crear mi Plan de Mejora ✍️
                                    </a>
                                </div>
                            </div>
                        `;
                        break;
                }

                tabContent.innerHTML = contentHTML;

                // Lógica de los gráficos para la pestaña de tendencias
                if (tabName === 'trends') {
                    const ctx = document.getElementById('performanceChart').getContext('2d');
                    const labels = ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'];
                    const categoryColors = {
                        'retencion': '#3b82f6',
                        'reincorporacion': '#10b981',
                        'procesos': '#8b5cf6',
                        'general': '#6b7280'
                    };

                    const createChart = (datasets) => {
                        if (chartInstance) {
                            chartInstance.destroy();
                        }
                        chartInstance = new Chart(ctx, {
                            type: 'line',
                            data: {
                                labels: labels,
                                datasets: datasets
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    legend: { display: false },
                                    tooltip: { mode: 'index', intersect: false }
                                },
                                scales: {
                                    y: {
                                        min: 70, max: 100,
                                        title: { display: true, text: 'Puntaje' },
                                        grid: { color: 'rgba(200, 200, 200, 0.5)' }
                                    },
                                    x: {
                                        title: { display: true, text: 'Módulo' },
                                        grid: { display: false }
                                    }
                                }
                            }
                        });
                    };

                    const chartCheckboxes = document.getElementById('chartCheckboxes');
                    const allCategories = Object.keys(userData.trends.scores);
                    const datasets = [];

                    allCategories.forEach(cat => {
                        const color = categoryColors[cat] || '#000000';
                        const isChecked = true; // Por defecto todos seleccionados
                        const checkbox = document.createElement('input');
                        checkbox.type = 'checkbox';
                        checkbox.id = `chart-cb-${cat}`;
                        checkbox.value = cat;
                        checkbox.checked = isChecked;
                        checkbox.className = 'mr-1';

                        const label = document.createElement('label');
                        label.htmlFor = `chart-cb-${cat}`;
                        label.className = 'text-sm font-semibold flex items-center cursor-pointer';
                        label.style.color = color;
                        label.textContent = userData.categories.find(c => c.id === cat)?.name || cat;

                        const span = document.createElement('span');
                        span.className = 'w-3 h-3 rounded-full mr-1';
                        span.style.backgroundColor = color;
                        label.prepend(span);

                        const div = document.createElement('div');
                        div.className = 'flex items-center';
                        div.appendChild(checkbox);
                        div.appendChild(label);

                        chartCheckboxes.appendChild(div);

                        if (isChecked) {
                            datasets.push({
                                label: userData.categories.find(c => c.id === cat)?.name || cat,
                                data: userData.trends.scores[cat],
                                borderColor: color,
                                backgroundColor: color,
                                borderWidth: 2,
                                fill: false,
                                tension: 0.4,
                                pointRadius: 5
                            });
                        }

                        checkbox.addEventListener('change', () => {
                            updateChartDatasets();
                        });
                    });

                    createChart(datasets);

                    const updateChartDatasets = () => {
                        const newDatasets = [];
                        const checkboxes = document.querySelectorAll('#chartCheckboxes input[type="checkbox"]');
                        checkboxes.forEach(cb => {
                            if (cb.checked) {
                                const cat = cb.value;
                                const color = categoryColors[cat] || '#000000';
                                newDatasets.push({
                                    label: userData.categories.find(c => c.id === cat)?.name || cat,
                                    data: userData.trends.scores[cat],
                                    borderColor: color,
                                    backgroundColor: color,
                                    borderWidth: 2,
                                    fill: false,
                                    tension: 0.4,
                                    pointRadius: 5
                                });
                            }
                        });
                        chartInstance.data.datasets = newDatasets;
                        chartInstance.update();
                    };

                    document.getElementById('selectAllButton').addEventListener('click', () => {
                        document.querySelectorAll('#chartCheckboxes input[type="checkbox"]').forEach(cb => cb.checked = true);
                        updateChartDatasets();
                    });

                    document.getElementById('deselectAllButton').addEventListener('click', () => {
                        document.querySelectorAll('#chartCheckboxes input[type="checkbox"]').forEach(cb => cb.checked = false);
                        updateChartDatasets();
                    });
                }
                
                // Lógica de los criterios de evaluación expandibles
                const criteriaToggles = document.querySelectorAll('.criteria-toggle');
                criteriaToggles.forEach(toggle => {
                    toggle.addEventListener('click', () => {
                        const targetId = toggle.getAttribute('data-target');
                        const targetList = document.querySelector(targetId);
                        const arrowIcon = toggle.querySelector('.criteria-button');
                        
                        if (targetList.classList.contains('hidden')) {
                            targetList.classList.remove('hidden');
                            arrowIcon.classList.add('rotate');
                        } else {
                            targetList.classList.add('hidden');
                            arrowIcon.classList.remove('rotate');
                        }
                    });
                });

                // Lógica para las tarjetas de la pestaña "Resumen General"
                const categoryTabs = document.querySelectorAll('.tab-button-internal');
                categoryTabs.forEach(tab => {
                    tab.addEventListener('click', (e) => {
                        const categoryId = e.target.getAttribute('data-category');
                        const type = e.target.getAttribute('data-type');
                        const card = e.target.closest('.card');
                        
                        // Eliminar la clase activa de todos los botones de la misma tarjeta
                        card.querySelectorAll('.tab-button-internal').forEach(btn => {
                            btn.classList.remove('active', 'bg-white', 'text-gray-800');
                            btn.style.backgroundColor = '';
                            btn.style.borderColor = '';
                        });
                        
                        // Obtener el color de la tarjeta
                        const cardColorClass = card.classList.item(2);
                        const cardColor = cardColorClass === 'bg-indigo-200' ? '#c7d2fe' : 
                                          cardColorClass === 'bg-green-200' ? '#d1fae5' :
                                          cardColorClass === 'bg-purple-200' ? '#e9d5ff' :
                                          cardColorClass === 'bg-yellow-200' ? '#fef9c3' :
                                          cardColorClass === 'bg-pink-200' ? '#fce7f3' :
                                          cardColorClass === 'bg-gray-200' ? '#e5e7eb' :
                                          cardColorClass === 'bg-lime-200' ? '#e2e8f0' : '#ffffff';

                        // Actualizar la clase activa del botón clickeado
                        e.target.classList.add('active', 'bg-white', 'text-gray-800');
                        e.target.style.backgroundColor = cardColor;
                        e.target.style.borderColor = '#2a6aff';

                        // Actualizar el comentario
                        const categoryData = userData.categories.find(cat => cat.id === categoryId);
                        const commentElement = document.getElementById(`comment-${categoryId}`);
                        if (categoryData && commentElement) {
                            commentElement.textContent = categoryData.comments[type];
                        }
                    });
                });
            }
        }

        // Renderiza la pantalla inicial al cargar la página
        document.addEventListener('DOMContentLoaded', renderLogin);
    </script>

</body>
</html>
